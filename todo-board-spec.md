# wall-todo プロジェクト仕様書

## 1. プロジェクト概要

### 1.1 背景と課題
- スマートフォンを開かないとToDoが見れない状況が、ToDoの実行を妨げている
- デバイスに依存せずに、日常的にタスクを消化できる環境を作りたい
- 通知ベースの習慣化アプリは通知を無視してしまい、続かない

### 1.2 目指す体験
- **「見ようとしなくても見えている」** - 部屋の壁にボードがあり、視界に自然に入る
- **「気づいたらやっている」** - 能動的な選択なしに、自然とタスクに手をつけている
- **「気づけばタスクが消えている」** - 即時フィードバックがあり、達成感を得られる
- **「常にタスク0の状態」** - タスクが滞留せず、スポーン→即消しのサイクル

### 1.3 設置環境
- 1Kの部屋の壁
- ベッドから起きた時に見える位置
- 部屋の移動時にも視界に入る位置

---

## 2. ユーザー特性

### 2.1 性格・行動パターン
- **MBTI**: ENFP
- **タスク実行タイミング**: 精神的・身体的に余裕がある時、気が向いた時
- **適切なタスクサイズ**: 5〜10分で完了できるもの
- **苦手なこと**:
  - ルーティン作業
  - 選択・分類作業
  - まとまった時間を要する作業の開始

### 2.2 現在のToDoツール使用方法
- **Todoist** を使用
- **追加方法**: Siri音声入力、アプリ、定期タスク設定
- **完了方法**: Siri音声入力（「〜を完了」）
- **運用方針**: 優先度・期限は基本的に設定しない（シンプルに保つ）

---

## 3. タスクの分類

### 3.1 表示対象とするタスク
ボードには以下の条件を満たすタスクを表示：
- **日付が「今日」に設定されているタスク**
- 全プロジェクトから取得
- 「今すぐ着手できる」タスクに日付を設定する運用

### 3.2 タスクの種類（参考）
| 種類 | 例 | 運用 |
|------|----|----|
| ルーティン（毎日） | 服薬、ストレッチ、掃除 | 定期タスクで今日の日付を設定 |
| ルーティン（週次） | シーツ交換、ゴミ出し | 定期タスクで今日の日付を設定 |
| 単発タスク（5-10分） | メール返信、LINE送信 | 追加時に今日の日付を設定 |
| クリエイティブ作業 | 企画書作成（30分以上） | 分解するか、日付を設定しない |

### 3.3 Todoist運用ルール
- タスク追加時に日付を「今日」に設定: 「Todoistに『メール返信 今日』を追加」
- 5分以上かかるタスクは分解するか、日付を設定せずTodoistに保管
- 定期タスクには繰り返し設定を使用
- Siriで完了報告後、最大1分でボードから消える

---

## 4. MVP仕様

### 4.1 基本方針
- **シンプルさ優先**: まず動くものを作り、体験してから改善
- **プレッシャーなし**: 通知や時間指定はなし、淡々と表示
- **即時フィードバック**: 完了後1分以内にボードから消える

### 4.2 表示仕様

#### 表示対象
- 日付が「今日」のタスク（`filter=today`）
- 取得順そのまま
- **上から10個まで**

#### レイアウト
- **シングルカラム** - 縦に並ぶ
- **下線区切りデザイン**
  - 各タスクの下に1px黒線（#333）
  - 角丸なし
  - 影なし
  - 番号なし
  - チェックボックスなし
- **背景**: 白
- **改行なし** - 1タスク1行

#### テキスト処理
- **CSS自動省略**（`text-overflow: ellipsis`）
- 画面幅に収まらない場合は「...」で省略
- 1タスク1行強制（`white-space: nowrap`）

#### フォント
- **種類**: Zen Kurenaido（筆ペン風、手書き感）
- **サイズ**: 24px
- **フォールバック**: Noto Serif CJK JP

#### タスク変更検知
- **前回取得したタスクをキャッシュ**（`.tasks_cache.json`）
- タスクに変更がない場合は画像生成と表示をスキップ
- e-paperの書き換え回数を削減し、ハードウェア寿命を延ばす

#### タスク0個 / エラー時の表示
- `/home/pi/wall-todo/images/` 内のPNG画像をランダム表示
- **日付固定**: 同じ日は同じ画像（日替わり）
- Todoist APIエラー時も同様に画像表示

---

## 5. 技術仕様

### 5.1 ハードウェア
- **Raspberry Pi Zero 2W**
- **Waveshare 7.5インチ e-Paper**
  - 解像度: 800×480
  - カラー: 白黒2色

### 5.2 ソフトウェアスタック
| 項目 | 選定 |
|------|------|
| 言語 | Python |
| HTML→画像変換 | WeasyPrint |
| CSS | 素のCSS（フレームワークなし） |
| フォント | Noto Sans JP |
| e-paper描画 | waveshare-epaper |
| 実行方法 | cron（1分ごと） |
| Todoist連携 | Todoist REST API v2 |
| 認証 | 環境変数でAPIトークン管理 |

### 5.3 開発フロー
1. PC環境で開発・PNG出力で動作確認
2. ラズパイに移植
3. cron設定

### 5.4 エラーハンドリング
| 状況 | 対応 |
|------|------|
| API失敗 | 画像表示 |
| e-paper書き込み失敗 | 何もしない |
| ログ | なし |

---

## 6. API仕様

### 6.1 Todoist API
- **エンドポイント**: `GET /rest/v2/tasks`
- **フィルタ**: `filter=today`
- **取得件数**: 10件

### 6.2 レスポンス例
```json
[
  {
    "id": "123",
    "content": "メール返信",
    "due": {
      "date": "2025-12-15",
      "is_recurring": false
    }
  }
]
```

### 6.3 レート制限
- 15分で1000リクエスト
- 1分ごとのcronは問題なし

---

## 7. ディレクトリ構成

```
/home/pi/wall-todo/
├── src/wall_todo/       # ソースコード
│   ├── main.py          # メインエントリーポイント
│   ├── renderer.py      # HTML→PNG変換
│   ├── epaper.py        # e-paper表示
│   ├── todoist.py       # Todoist API連携
│   ├── convert.py       # 画像変換
│   ├── fallback.py      # フォールバック画像選択
│   └── templates/
│       └── board.html   # HTMLテンプレート
├── images/              # フォールバック画像（480x800px）
├── uploads/             # 画像アップロード用（自動変換）
├── fonts/               # Zen Kurenaidoフォント
├── .env                 # API_KEY
├── .tasks_cache.json    # タスクキャッシュ（自動生成）
└── output.png           # 生成画像（自動生成）
```

---

## 8. 今後の拡張可能性（スコープ外）

以下は現時点でのMVPには含まれないが、将来的に検討可能：
- タスクの優先度表示
- 期限表示
- カテゴリ別色分け
- 複数ラベル対応
- タスク完了数の可視化
- 更新頻度の最適化（完了検知による即時更新）

---

## 9. 成功基準

このプロジェクトは以下の状態が実現できれば成功：
1. 壁のボードを見るだけでタスクが分かる
2. スマホを開かずにタスクを把握できる
3. 気づいたらタスクに手をつけている
4. Siriで完了したらボードから消える
5. タスクが滞留せず、0の状態を維持できる

---

**作成日**: 2025-12-13
**最終更新**: 2026-01-25
**バージョン**: 3.0
**ステータス**: 実装完了・仕様確定
